<div ng-include="'app/partials/navbar.html'" ng-init="pageTitle='Admin'"></div>

<div class="dashboard-edit-view" style="min-height: 500px">
	<div class="editor-row">
		<div class="section">

			<div class="dashboard-editor-header">
				<div class="dashboard-editor-title">
					<i class="icon icon-sitemap"></i>
					Monitors
				</div>

				<div ng-model="editor.index" bs-tabs style="text-transform:capitalize;">
					<div ng-repeat="tab in ['Overview', 'Add', 'Edit']" data-title="{{tab}}">
					</div>
				</div>

			</div>

			<form name="editForm">
				<div class="dashboard-editor-body">

					<div class="editor-row row" ng-if="editor.index == 0">
						<div class="span8">
							<span>TODO: filters.  FilterByName, FilterByType, FilterByLocation</span>
							<div ng-if="monitors.length === 0">
								<em>No monitors defined</em>
							</div>
							<table class="grafana-options-table">
								<tr ng-repeat="mon in monitors">
									<td style="width:1%">
										<a href="dashboard/monitor/{{mon.id}}">
											<i class="fa fa-signal"></i>
											{{mon.name}}
										</a>
									</td>
									<td style="width:90%">
										{{monitor_types[mon.monitor_type_id].name}}
									</td>
									<td style="width:90%">
										{{location_list(mon)}}
									</td>
									<td style="width: 1%">
										<a ng-click="edit(mon)" class="btn btn-success btn-mini">
											<i class="fa fa-edit"></i>
											Edit
										</a>
									</td>
									<td style="width: 1%">
										<a ng-click="remove(mon)" class="btn btn-danger btn-mini">
											<i class="fa fa-remove"></i>
										</a>
									</td>
								</tr>
							</table>
						</div>
					</div>

					<div ng-if="editor.index == 1 || (editor.index == 2 && !currentIsNew)">
						<div class="editor-row">
							<div class="editor-option">
								<label class="small">Name</label>
								<input type="text" class="input-large" ng-model='current.name' placeholder="name" required></input>
							</div>
							<div class="editor-option">
								<label class="small">Type</label>
								<select class="input-medium" ng-model="current.monitor_type_id" ng-options="t.id as t.name for (id, t) in monitor_types" ng-change="typeChanged()"></select>
							</div>
						</div>

						<div class="editor-row">
							<div class="editor-option">
								<label class="small">Locations</label>
								<select class="input-medium" ng-model="current.locations" ng-options="l.id as l.name for (id, l) in locations" multiple></select>
							</div>
							<div class="editor-option">
								<label class="small">Frequency</label>
								<input type="number" class="input-large" ng-model='current.frequency' placeholder="Frequency" required></input>
							</div>
							<div class="editor-option">
								<label class="small">Enabled</label>
								<input type="checkbox" class="input-large" ng-model='current.enabled' required></input>
							</div>
						</div>
						<div class="dashboard-editor-header">
							<div class="dashboard-editor-title">Settings</div>
						</div>
						<div class="editor-row">
							
							<div class="editor-option" ng-repeat="setting in monitor_types[current.monitor_type_id].settings | filter:{required: 'true'}">
								<label class="small">{{setting.variable}}</label>
								<raintank-setting definition="setting" target="currentSettingByVariable(setting.variable)">
							</div>
						</div>
						<div class="editor-row">
							
							<div class="editor-option" ng-repeat="setting in monitor_types[current.monitor_type_id].settings | filter:{required: 'false'}">
								<label class="small">{{setting.variable}}</label>
								<raintank-setting definition="setting" target="currentSettingByVariable(setting.variable)">
							</div>
						</div>

					</div>

					<div class="dashboard-editor-footer" style="margin-top: 20px">
						<button type="submit" class="btn btn-success" ng-show="editor.index === 1" ng-click="add()">Add</button>
						<button type="submit" class="btn btn-success" ng-show="editor.index === 2 && !currentIsNew" ng-click="update()">Update</button>
						<button type="submit" class="btn btn-info" ng-show="editor.index === 2 && !currentIsNew" ng-click="cancel()">Cancel</button>
					</div>

				</form>
			</div>
		</div>
	</div>
</div>
